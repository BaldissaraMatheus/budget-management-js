"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var dataCtrl=function(){var data={groups:[],totals:{exp:0,inc:0}},options={exp:{names:["Comida","Saúde","Serviços","Educação","Transporte","Entreterimento","Produtos Essenciais","Produtos Diversos","Impostos","Empréstimos","Investimentos","Outros"],values:["food","health","serv_exp","educ","trasp","ent","prod_ess","prod_misc","tax","loan","inv_exp","others_exp"],icons:["fa-utensils","fa-stethoscope","fa-cut","fa-university","fa-car","fa-gamepad","fa-home","fa-shopping-cart","fa-balance-scale","fa-money-bill-alt","fa-chart-pie","fa-bomb"]},inc:{names:["Salário","Vendas","Serviços","Investimentos","Outros"],values:["sal","sales","serv_inc","inv_inc","others_inc"],icons:["fa-money-bill-alt","fa-truck","fa-briefcase","fa-chart-line","fa-bomb"]}};return{getOptions:function(){return options},addGroup:function(name,type,text){var pos=void 0;if(0!=data.groups.length&&(pos=data.groups.findIndex(function(obj,index){return obj.name===name})),pos<0||void 0===pos){var newGroup=new function Group(name,type,text,total_value){_classCallCheck(this,Group),this.name=name,this.type=type,this.text=text,this.total_value=total_value,this.items=[]}(name,type,text,0);return data.groups.push(newGroup),newGroup}return data.groups[pos]},addItem:function(group,type,desc,value){var newItem,date=moment().format("DD/MM/YYYY"),id=0,pos=data.groups.findIndex(function(obj,index){return obj.name===group});return 0<data.groups[pos].items.length&&(id=data.groups[pos].items[data.groups[pos].items.length-1].id+1),newItem=new function Item(id,desc,value,date){_classCallCheck(this,Item),this.id=id,this.desc=desc,this.value=value,this.date=date}(id,desc,value,date),data.groups[pos].items.push(newItem),newItem},updateGroupValue:function(group,item){var sum=group.total_value+item.value;return group.total_value=parseFloat(sum.toFixed(2)),group.total_value},updateTotals:function(item,group){var type=group.type;return data.totals[type]+=item.value,data.totals},getItemData:function(item){var id=item.id;id=id.split(item.group+"-"),id=parseInt(id[1]);var groupIndex=data.groups.findIndex(function(group,i){return group.name===item.group}),itemIndex=data.groups[groupIndex].items.findIndex(function(groupItem,i){return groupItem.id===id});return{groupIndex:groupIndex,itemIndex:itemIndex,value:-1*data.groups[groupIndex].items[itemIndex].value,id:id,group:item.group,type:item.type}},getGroupData:function(item){var group=data.groups[item.groupIndex];return{name:group.name,type:group.type,text:group.text,total_value:group.total_value}},verGroup:function(item){return 0===data.groups[item.groupIndex].items.length},deleteItem:function(item){data.groups[item.groupIndex].items.splice(item.itemIndex,1)},deleteGroup:function(item,proceed){proceed&&data.groups.splice(item.groupIndex,1)}}}(),UICtrl=function(){var DOMstrings={addBtn:"add-btn",createBtn:"create-btn",addForm:"form-add",inputValue:"value",selectGroup:"group",inputDesc:"desc",selectType:"type",container:"cards-container",containerInc:"container-inc",containerExp:"container-exp",containerMobile:"container-mobile",filterSelect:"filter"};return{getDOMstrings:function(){return DOMstrings},getInput:function(){var inputValue=document.getElementById(DOMstrings.inputValue).value;if(inputValue.includes(","))for(inputValue=inputValue.replace(",",".");inputValue.includes(",");)inputValue=inputValue.replace(",","");return{groupName:document.getElementById(DOMstrings.selectGroup).value,selectOptionIndex:document.getElementById(DOMstrings.selectGroup).selectedIndex,desc:document.getElementById(DOMstrings.inputDesc).value,type:document.getElementById(DOMstrings.selectType).value,value:parseFloat(inputValue),filter:document.getElementById(DOMstrings.filterSelect).value}},clearFields:function(){document.getElementById(DOMstrings.inputDesc).value="",document.getElementById(DOMstrings.inputValue).value="",document.getElementById(DOMstrings.filterSelect).value="all"},setTypeInc:function(){document.getElementById(DOMstrings.selectType).selectedIndex=0},displayCharts:function(winWidth){var chartGnrlEl=document.getElementById("chart--general").getContext("2d"),chartExpEl=document.getElementById("chart--exp").getContext("2d"),chartIncEl=document.getElementById("chart--inc").getContext("2d"),green=["#50CC80","#4E9CBA","#B0EF5E","#76BAD4","#6260C7"],red=["#F8545F","#FFAA56","#E42E3B","#FFD856","#BA121E","#EA8C30","#FA7781","#FFE079","#FFBC79","#EABF30","#FFD2A5"],legDisplay=!0;return 768<=winWidth&&(legDisplay=!1),Chart.defaults.global.responsive=!0,Chart.defaults.global.legend.display=legDisplay,[new Chart(chartGnrlEl,{type:"pie",data:{labels:["Rendas","Despesas"],datasets:[{data:[0,0],backgroundColor:[green[0],red[0]]}]}}),new Chart(chartIncEl,{type:"pie",data:{labels:[],datasets:[{data:[],backgroundColor:[green[0],green[1],green[2],green[3],green[4]]}]}}),new Chart(chartExpEl,{type:"pie",data:{labels:[],datasets:[{data:[],backgroundColor:[red[0],red[1],red[2],red[3],red[4],red[5],red[6],red[7],red[8],red[9],red[10]]}]}})]},addGroupUI:function(group,mobileDevice,icon){var containerInc=DOMstrings.containerInc,containerExp=DOMstrings.containerExp,html=void 0;document.getElementById(group.name)||((html=(html=(html=(html=(html=(html=(html="inc"===group.type?"<div id='$ID' class='card shadow $TYPE'><div class='card__head'><div class='card__icon card__icon--$TYPE-ICON'><i class='fas $ICON fa-2x'></i></div><div class='card__data'><h2>$NAME<h2><h2 class='data__value'>+R$$VALUE</h2></div></div><ul class='card__list $LISTCLASS'></ul></div>":"<div id='$ID' class='card shadow $TYPE'><div class='card__head'><div class='card__icon card__icon--$TYPE-ICON'><i class='fas $ICON fa-2x'></i></div><div class='card__data'><h2>$NAME<h2><h2 class='data__value'>-R$$VALUE</h2></div></div><ul class='card__list $LISTCLASS'></ul></div>").replace("$ID",group.name)).replace("$TYPE",group.type)).replace("$NAME",group.text)).replace("$VALUE",group.total_value)).replace("$TYPE-ICON",group.type)).replace("$ICON",icon)).includes("$LISTCLASS")&&(html=html.replace("$LISTCLASS",group.name)),"inc"===group.type?document.getElementById(containerInc).insertAdjacentHTML("beforeend",html):document.getElementById(containerExp).insertAdjacentHTML("beforeend",html))},addItemUI:function(item,group){var id,container="."+group.name,html=void 0,sign=void 0;sign="inc"===group.type?"+":"-",id=group.name+"-"+item.id,html=(html=(html=(html=(html=(html="<li class='card__list__item' id='$ID'><div class='item__main-data'><h3>$DESC</h3><h4 class='data__value'>$SIGNR$$VALUE</h4></div><div><h6>$DATE</h6><h2><a href='javascript:' class='del-btn'>-</a></h2></div></li>").replace("$DESC",item.desc)).replace("$VALUE",item.value)).replace("$SIGN",sign)).replace("$DATE",item.date)).replace("$ID",id),document.querySelector(container).insertAdjacentHTML("beforeend",html)},updateGroupValueUI:function(group){var value=document.getElementById(group.name).getElementsByClassName("data__value")[0],sign=void 0;sign="inc"===group.type?"+":"-",value.innerHTML=sign+"R$"+group.total_value},updateOptions:function(options,type){for(var optionSelector=document.getElementById("group"),names=options[type].names,values=options[type].values,i=optionSelector.options.length-1;0<=i;i--)optionSelector.options.remove(i);for(var _i=0;_i<names.length;_i++){var option=document.createElement("option");option.text=names[_i],option.value=values[_i],optionSelector.options.add(option)}},updateCharts:function(charts,item,group,totals){var i=void 0,balance=void 0;balance=totals.exp>totals.inc?100:(balance=totals.exp/totals.inc*100).toFixed(2),charts[0].data.datasets[0].data[1]=balance,charts[0].data.datasets[0].data[0]=100-balance;var index=charts[i="inc"===group.type?1:2].data.labels.findIndex(function(el,index){return el===group.text});-1!==index?charts[i].data.datasets[0].data[index]+=item.value:(charts[i].data.labels.push(group.text),charts[i].data.datasets[0].data.push(item.value)),charts.forEach(function(el){el.update()})},updateBudget:function(inc,exp){var budgetContainer=document.getElementById("display-budget"),expContainer=document.getElementById("display-exp"),incContainer=document.getElementById("display-inc"),expPercent=document.getElementById("display-percent"),percent=void 0;percent=0!==inc?(percent=exp/inc*100).toFixed(2):0,expContainer.innerHTML="R$"+exp.toFixed(2),incContainer.innerHTML="R$"+inc.toFixed(2),budgetContainer.innerHTML="R$"+(inc-exp).toFixed(2),expPercent.innerHTML=percent+"% do saldo gasto"},deleteItem:function(item){var DOMitem=document.getElementById(item.group+"-"+item.id);DOMitem.parentNode.removeChild(DOMitem)},deleteGroup:function(item,proceede){var card=document.getElementById(item.group);proceede&&card.parentNode.removeChild(card)},displayForm:function(){document.getElementById(DOMstrings.addForm).classList.toggle("js-hide")},hideForm:function(){document.getElementById(DOMstrings.addForm).classList.add("js-hide")},showForm:function(){document.getElementById(DOMstrings.addForm).classList.remove("js-hide")},showSelectedItems:function(selection){var containerInc=document.getElementById(DOMstrings.containerInc),containerExp=document.getElementById(DOMstrings.containerExp);containerInc.classList.remove("js-hide"),containerExp.classList.remove("js-hide"),"inc"===selection?containerExp.classList.add("js-hide"):"exp"===selection&&containerInc.classList.add("js-hide")}}}(),mainCtrl=function(dataCtrl,UICtrl){var options=dataCtrl.getOptions(),winWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),mobileDevice=!1,charts=void 0,ctrlAddItem=function(){var input=UICtrl.getInput(),totals=void 0,newItem=void 0,newGroup=void 0;isNaN(input.value)||(""===input.desc&&(input.desc="Sem descrição"),newGroup=dataCtrl.addGroup(input.groupName,input.type,options[input.type].names[input.selectOptionIndex]),newItem=dataCtrl.addItem(input.groupName,input.type,input.desc,function(input){var outputValue=input;return outputValue=Math.abs(outputValue),outputValue=parseFloat(outputValue.toFixed(2))}(input.value)),UICtrl.addGroupUI(newGroup,mobileDevice,options[input.type].icons[input.selectOptionIndex]),UICtrl.addItemUI(newItem,newGroup),dataCtrl.updateGroupValue(newGroup,newItem),UICtrl.updateGroupValueUI(newGroup),UICtrl.updateOptions(options,newGroup.type),totals=dataCtrl.updateTotals(newItem,newGroup),UICtrl.updateCharts(charts,newItem,newGroup,totals),UICtrl.updateBudget(totals.inc,totals.exp),UICtrl.showSelectedItems("all"),UICtrl.clearFields())},ctrlDelItem=function(e){var item=function(e){var selector=e.target;if(selector.classList.contains("del-btn")){var id=(selector=selector.parentNode.parentNode.parentNode).id,group=selector.parentNode;group=(group=group.className.split(" "))[group.length-1];var type=selector.parentNode.parentNode;return{id:id,group:group,type:type=(type=type.className.split(" "))[type.length-1]}}}(e);item=dataCtrl.getItemData(item);var emptyGroup,group=dataCtrl.getGroupData(item),totals=dataCtrl.updateTotals(item,group);dataCtrl.deleteItem(item),emptyGroup=dataCtrl.verGroup(item),dataCtrl.updateGroupValue(group,item),UICtrl.updateGroupValueUI(group),dataCtrl.deleteGroup(item,emptyGroup),UICtrl.deleteItem(item),UICtrl.deleteGroup(item,emptyGroup),UICtrl.updateBudget(totals.inc,totals.exp),UICtrl.updateCharts(charts,item,group,totals)},setEvtLst=function(){var DOMobj=UICtrl.getDOMstrings();document.getElementById(DOMobj.addBtn).addEventListener("click",ctrlAddItem),document.addEventListener("keypress",function(event){13!==event.keycode&&13!==event.which||ctrlAddItem()}),document.getElementById(DOMobj.selectType).addEventListener("change",function(){var input=UICtrl.getInput();UICtrl.updateOptions(options,input.type)}),document.getElementById(DOMobj.filterSelect).addEventListener("change",function(){var input=UICtrl.getInput();UICtrl.showSelectedItems(input.filter)}),document.getElementById(DOMobj.createBtn).addEventListener("click",function(){UICtrl.displayForm()}),document.getElementById(DOMobj.container).addEventListener("click",ctrlDelItem),window.addEventListener("resize",function(){winWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),!0===mobileDevice&&768<winWidth?(mobileDevice=!1,UICtrl.showForm()):!1===mobileDevice&&winWidth<768&&(mobileDevice=!0,UICtrl.hideForm())})};return{init:function(){charts=function(winWidth){return UICtrl.displayCharts(winWidth)}(winWidth),UICtrl.clearFields(),UICtrl.updateBudget(0,0),UICtrl.setTypeInc(),UICtrl.updateOptions(dataCtrl.getOptions(),"inc"),UICtrl.showSelectedItems("all"),setEvtLst()}}}(dataCtrl,UICtrl);mainCtrl.init();